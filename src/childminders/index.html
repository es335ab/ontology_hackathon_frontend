<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link rel="stylesheet" media="all" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.css" />
  <link rel="stylesheet" media="all" href="/css/style.css" />
  <script
    src="https://code.jquery.com/jquery-3.3.1.js"
    integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60="
    crossorigin="anonymous"></script>
  <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.qrcode/1.0/jquery.qrcode.min.js"></script> -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.9.1/underscore-min.js"></script>
  <script src="/scripts/lib/browser.js"></script>
  <script src="/scripts/utils.js"></script>
  <script src="/scripts/provider.js"></script>
  <title>test</title>
</head>
<body>
  <div class="l-wrapper">
    <div class="l-header">
      <div class="inner">
        <h2>nurserise</h2>
      </div>
    </div>

    <main class="l-main">
      <div class="l-block u-mt-10">
        <h1 class="block-heading inner u-pb-0">
          保育士一覧
        </h1>
        <div class="body">
          <div class="cassettes" id="js-childminders"></div>
        </div>
      </div>
    </main>
  </div>

  <div class="l-global-loading" id="global-loading">
    <div class="background">
      <div class="loftloader-wrapper pl-circles">
        <div class="loader">
          <span></span>
        </div>
      </div>
    </div>
  </div>

  <script id="js-childminder-template" type="text/template">
    <% _.each(data, function(item) { %>
      <a class="m-cassette" href="<%- 'http://' + location.host + '/childminders/show?childminder_address=' + item['address'] %>">
        <div class="inner">
          <div class="u-table">
            <div class="info">
              <div class="lead"><%- item['name'] %></div>
              <div class="supplyment">トークン保有数：<%- item['amount'] %></div>
            </div>
<!--             <div class="qr-wrapper">
            </div> -->
          </div>
        </div>
      </a>
    <% }); %>
  </script>

  <script>
    (function(){
      // setting
      // var contract = '39f3fb644842c808828817bd73da0946d99f237f';
      // var method = 'Hello';
      // var parameters = [{ type: 'Integer', value: 5 }, { type: 'Integer', value: 4 }];
      // var gasPrice = 500;
      // var gasLimit = 30000;
      // function attachQR() {
      //   $('#js-childminders').find('.m-cassette').each(function(index, element) {
      //     var $element = $(element);
      //     var url = $element.attr('href');

      //     $element.find('.qr-wrapper').qrcode({
      //       text: url
      //     });
      //   });
      // }


      // init
      utils.loadingOn();

      // TODO ここをcontractのメソッド呼び出しに変える
      //      メソッドの戻り値を配列に入れる
      var dummyChildminders = [
        {
          name: '阿部 太郎',
          address: '0x10D27eC867701F5e55Aefc12E79D82e539938d0c',
          amount: 20
        },
        {
          name: '片桐 二郎',
          address: '0x26007D2d96fBF35175CbBd613f6B575C2de8E20A',
          amount: 30
        },
        {
          name: '大谷 翔平',
          address: '0x10D27eC867701F5e55Aefc12E79D82e539938d0c',
          amount: 50
        }
      ];
      setTimeout(function() {
        utils.render(dummyChildminders, '#js-childminder-template', '#js-childminders');
        utils.loadingOff();
        // attachQR();
      }, 300);
    })();
  </script>
</body>
</html>
